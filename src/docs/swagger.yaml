openapi: 3.0.0
info:
  title: Yummi API
  description: REST API documentation for a recipe sharing platform built with Node.js, Express, and PostgreSQL
  version: 1.0.1

servers:
  - url: http://localhost:3000/api
    description: Local development server

paths:
  /health:
    get:
      summary: Health check
      description: Check if the server is running
      responses:
        '200':
          description: Server is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: OK
                  timestamp:
                    type: string
                    format: date-time
                  uptime:
                    type: number

  /auth/register:
    post:
      summary: Register user
      description: Create a new user account
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - email
                - password
              properties:
                username:
                  type: string
                  example: john_doe
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  example: SecurePassword123
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Validation error
        '409':
          description: User already exists

  /auth/login:
    post:
      summary: Login user
      description: Authenticate user and return JWT token
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  example: SecurePassword123
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Invalid credentials

  /auth/logout:
    post:
      summary: Logout user
      description: Logout authenticated user
      tags: [Authentication]
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Logout successful
        '401':
          description: Not authenticated

  /users/me:
    get:
      summary: Get current user info
      tags: [Users]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Current user info
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserMe'
        '401':
          description: Unauthorized

  /users/{id}:
    get:
      summary: Get another user's details
      tags: [Users]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: User ID
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserDetail'
        '404':
          description: User not found

  /users/avatar:
    patch:
      summary: Update user avatar
      tags: [Users]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - avatar
              properties:
                avatar:
                  type: string
                  format: binary
      responses:
        '200':
          description: Avatar updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  avatarURL:
                    type: string
                    format: uri
        '400':
          description: File required
        '401':
          description: Unauthorized

  /categories:
    get:
      summary: Get all categories
      description: Get list of all recipe categories
      tags: [Categories]
      responses:
        '200':
          description: List of categories
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'

  /areas:
    get:
      summary: Get all areas
      description: Get list of all cuisine areas/regions
      tags: [Areas]
      responses:
        '200':
          description: List of areas
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Area'

  /ingredients:
    get:
      summary: Get all ingredients
      description: Get list of all available ingredients
      tags: [Ingredients]
      responses:
        '200':
          description: List of ingredients
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Ingredient'

  /testimonials:
    get:
      summary: Get all testimonials
      description: Get list of all user testimonials
      tags: [Testimonials]
      responses:
        '200':
          description: List of testimonials
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Testimonial'

  /recipes:
    get:
      summary: Search and filter recipes
      description: Public endpoint for searching recipes by category, ingredient, and area with pagination and sorting
      tags: [Recipes]
      parameters:
        - name: category
          in: query
          description: Category UUID to filter by
          schema:
            type: string
            format: uuid
            example: 3d2c9d2a-5a10-4e0f-bc6a-1c2f3b4d5e6f
        - name: ingredient
          in: query
          description: Ingredient name to search for (partial match)
          schema:
            type: string
            example: tomato
        - name: area
          in: query
          description: Area UUID to filter by
          schema:
            type: string
            format: uuid
            example: 1a2b3c4d-5e6f-7a8b-9c0d-1e2f3a4b5c6d
        - name: page
          in: query
          description: Page number
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          description: Number of recipes per page
          schema:
            type: integer
            default: 12
            minimum: 1
            maximum: 50
        - name: sortBy
          in: query
          description: Field to sort by
          schema:
            type: string
            enum: [popularity, title, createdAt, time]
            default: createdAt
        - name: sortDir
          in: query
          description: Sort direction
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: List of recipes with pagination info
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Recipe'
                  totalCount:
                    type: integer
                    description: Total number of recipes matching the filters
    post:
      summary: Create recipe
      description: Private endpoint for creating a new recipe
      tags: [Recipes]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRecipeRequest'
      responses:
        '201':
          description: Recipe created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Recipe'
        '400':
          description: Validation error
        '401':
          description: Authentication required

  /recipes/popular:
    get:
      summary: Get popular recipes
      description: Public endpoint for getting popular recipes sorted by favorites count
      tags: [Recipes]
      parameters:
        - name: page
          in: query
          description: Page number
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          description: Number of recipes per page
          schema:
            type: integer
            default: 12
            minimum: 1
            maximum: 50
      responses:
        '200':
          description: List of popular recipes with pagination info
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Recipe'
                  totalCount:
                    type: integer
                    description: Total number of popular recipes

  /recipes/{id}:
    get:
      summary: Get recipe by ID
      description: Public endpoint for getting detailed recipe information
      tags: [Recipes]
      parameters:
        - name: id
          in: path
          required: true
          description: Recipe ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Recipe details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Recipe'
        '404':
          description: Recipe not found
    patch:
      summary: Update recipe
      description: Private endpoint for updating own recipe
      tags: [Recipes]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Recipe ID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRecipeRequest'
      responses:
        '200':
          description: Recipe updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Recipe'
        '400':
          description: Validation error
        '401':
          description: Authentication required
        '403':
          description: Access denied
        '404':
          description: Recipe not found
    delete:
      summary: Delete recipe
      description: Private endpoint for deleting own recipe
      tags: [Recipes]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Recipe ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Recipe deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Recipe deleted successfully
        '401':
          description: Authentication required
        '403':
          description: Access denied
        '404':
          description: Recipe not found

  /recipes/{id}/favorite:
    post:
      summary: Add to favorites
      description: Private endpoint for adding recipe to favorites
      tags: [Recipes]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Recipe ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Recipe added to favorites
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Recipe added to favorites
        '400':
          description: Recipe already in favorites
        '401':
          description: Authentication required
        '404':
          description: Recipe not found
    delete:
      summary: Remove from favorites
      description: Private endpoint for removing recipe from favorites
      tags: [Recipes]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Recipe ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Recipe removed from favorites
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Recipe removed from favorites
        '401':
          description: Authentication required
        '404':
          description: Recipe not found in favorites

  /users/{id}/followers:
    get:
      summary: Get user's followers
      tags: [ Users ]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Followers list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FollowersResponse'
        '404':
          description: User not found

  /users/{id}/following:
    get:
      summary: Get user's following
      tags: [ Users ]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Following list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FollowersResponse'
        '404':
          description: User not found

  /users/{id}/follow:
    post:
      summary: Follow a user
      description: Authenticated user follows the specified user
      tags: [ Users ]
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: id
          required: true
          description: Target user ID to follow
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Followed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FollowActionResponse'
        '400':
          description: Already following or invalid action
        '401':
          description: Authentication required
        '404':
          description: User not found

  /users/{id}/unfollow:
    delete:
      summary: Unfollow a user
      description: Authenticated user unfollows the specified user
      tags: [ Users ]
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: id
          required: true
          description: Target user ID to unfollow
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Unfollowed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FollowActionResponse'
        '401':
          description: Authentication required
        '404':
          description: Follow relation not found

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    AuthResponse:
      type: object
      properties:
        token:
          type: string
        user:
          $ref: '#/components/schemas/User'
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        email:
          type: string
          format: email
        avatarUrl:
          type: string
          format: uri
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    UserMe:
      allOf:
        - $ref: '#/components/schemas/User'
    UserDetail:
      allOf:
        - $ref: '#/components/schemas/User'

    Category:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 3d2c9d2a-5a10-4e0f-bc6a-1c2f3b4d5e6f
        name:
          type: string
          example: Dessert

    Area:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 1a2b3c4d-5e6f-7a8b-9c0d-1e2f3a4b5c6d
        name:
          type: string
          example: Italian

    Ingredient:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 9b8a7c6d-5e4f-3a2b-1c0d-9e8f7a6b5c4d
        name:
          type: string
          example: Tomato

    Testimonial:
      type: object
      properties:
        id:
          type: string
          format: uuid
        text:
          type: string
        author:
          type: string

    Recipe:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        time:
          type: integer
          description: Cooking time in minutes
        areaId:
          type: string
          format: uuid
        categoryId:
          type: string
          format: uuid
        ingredients:
          type: array
          items:
            type: string
        instructions:
          type: array
          items:
            type: string
        favoritesCount:
          type: integer
        authorId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateRecipeRequest:
      type: object
      required: [title, description, time, categoryId, areaId, ingredients, instructions]
      properties:
        title:
          type: string
        description:
          type: string
        time:
          type: integer
        categoryId:
          type: string
          format: uuid
        areaId:
          type: string
          format: uuid
        ingredients:
          type: array
          items:
            type: string
        instructions:
          type: array
          items:
            type: string

    UpdateRecipeRequest:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        time:
          type: integer
        categoryId:
          type: string
          format: uuid
        areaId:
          type: string
          format: uuid
        ingredients:
          type: array
          items:
            type: string
        instructions:
          type: array
          items:
            type: string

    FollowersResponse:
      type: object
      properties:
        items:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                format: uuid
                example: 2b4439c1-a352-409a-92ff-382ab4cb3bbf
              name:
                type: string
                example: Larry Pageim
              avatarUrl:
                type: string
                nullable: true
                example: null
        totalCount:
          type: integer
          example: 1

    FollowActionResponse:
      type: object
      properties:
        message:
          type: string
          description: Status message about follow/unfollow action
          example: Followed